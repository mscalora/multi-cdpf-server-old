/*
 * jQuery.upload2 v1.0.2
 *
 * Copyright (c) 2010 lagos
 * Dual licensed under the MIT and GPL licenses.
 *
 * http://lagoscript.org
 *
 * modified by mike scalora
 */
(function(e){function n(t){return e.map(r(t),function(e){return'<input type="hidden" name="'+e.name+'" value="'+e.value+'"/>'}).join("")}function r(t){function r(e,t){n.push({name:e,value:t})}if(e.isArray(t)){return t}var n=[];if(typeof t==="object"){e.each(t,function(t){if(e.isArray(this)){e.each(this,function(){r(t,this)})}else{r(t,e.isFunction(this)?this():this)}})}else if(typeof t==="string"){e.each(t.split("&"),function(){var t=e.map(this.split("="),function(e){return decodeURIComponent(e.replace(/\+/g," "))});r(t[0],t[1])})}return n}function i(t,n){var r,i=e(t).contents().get(0);if(e.isXMLDoc(i)||i.XMLDocument){return i.XMLDocument||i}r=e(i).find("body").html();switch(n){case"xml":r=s(r);break;case"json":r=window.eval("("+r+")");break}return r}function s(e){if(window.DOMParser){return(new DOMParser).parseFromString(e,"application/xml")}else{var t=new ActiveXObject("Microsoft.XMLDOM");t.async=false;t.loadXML(e);return t}}var t=0;e.fn.upload2=function(r,s,o,u){var a=this,f,l,c,h="jquery_upload"+ ++t,p=e('<iframe name="'+h+'" style="position:absolute;top:-9999px" />').appendTo("body"),d='<form target="'+h+'" method="post" enctype="multipart/form-data" />';if(e.isFunction(s)){u=o;o=s;s={}}l=e("input:checkbox",this);c=e("input:checked",this);d=a.wrapAll(d).parent("form").attr("action",r);l.removeAttr("checked");c.attr("checked",true);f=n(s);f=f?e(f).appendTo(d):null;d.submit(function(){o.call(a,"start");p.load(function(){var t=i(this,u),n=e("input:checked",a);d.after(a).remove();l.removeAttr("checked");n.attr("checked",true);if(f){f.remove()}setTimeout(function(){p.remove();if(u==="script"){e.globalEval(t)}if(o){o.call(a,"finish",t)}},0)})}).submit();return this}})(jQuery)
